<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <!--
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <script type="text/javascript" src="../js/jquery-1.11.0.min.js"></script>
    -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous"> 
	
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	
    <title>Inicio</title>
  </head>
  <body>
	
	<div id="NoMovil" style="display:none;">	
		<div style="width:150px; float:left; position: absolute; top:50px; bottom: 0; background-color:#212529;">
			<nav class="navbar navbar-dark bg-dark">
	            <ul class="navbar-nav">
	               <li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Animales.html">Animales</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Crias.html">Venta crías</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Leche.html">Leche</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./AlimentosSuministrados.html">Alimentos Suministrados</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./PiensosMedicamentosos.html">Piensos Medicamentosos</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Medicamentos.html">Medicamentos</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Enfermedades.html">Enfermedades</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Pastos.html">Pastos</a></li>
					<!-- 
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Inspecciones.html">Inspecciones</a></li>
					 -->
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Incidencias.html">Incidencias</a></li>
					<li class="nav-item"><a class="nav-link active"
						style="padding-left: 10px; width: 150px;"
						href="./Exportaciones.html">Exportaciones</a></li>
	            </ul>
	        </nav>
        </div>
        
        <div>
		<nav class="navbar navbar-dark bg-dark justify-content-end">
			<div class="container-fluid" style="float:left;">
				<a class="navbar-brand" href="./Inicio.html"><img src="./icono.png" width="10%" height="10%" style="display:inline; text-align:center;"></a>
			
				<div class="dropdown">
					<a class="nav-link dropdown-toggle" href="#"
						id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown"
						aria-expanded="false"> <b><script>document.write(sessionStorage.getItem("usuario_activo"));</script></b>
					</a>
					<ul class="dropdown-menu dropdown-menu-end"
						aria-labelledby="navbarDropdownMenuLink">
						<li><a class="dropdown-item" onclick="VerPerfil()">Ver
								Perfil</a></li>
						<li><a class="dropdown-item" onclick="CerrarSesion()">Cerrar
								Sesión</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</div>

		<div class="card" style="text-align:center;">
		  <div class="card-body" style="margin-left: 150px;position: absolute; text-align:center; width: 80%">
		    <h3 class="card-title">¡BIENVENIDO <script>document.write(sessionStorage.getItem("usuario_activo"));</script>! </h3>
		    <img src="./facebook_cover_photo_1.png" width="70%" height="70%" style="display:inline; text-align:center;">
		    </br>
		    <p class="card-text"><em>En esta aplicación podrás realizar todas las gestiones para rellenar el libro de registro de tu explotación ganadera</em></p>
		    <p class="card-text"><em>A continuación se mostrarán las explotaciones dadas de alta para su usuario:</em></p>
		    <p class="card-text">
		    <div style="text-align:center;">
				<div id="listadoExplotaciones"></div>
			</div>
			</p>
		    
		    
		  </div>
		  
		  
		</div>
		
		
		
		
	</div>
	
	<div id="Movil" style="display: none;">
		<div
			style="width: 60px; float: left; position: fixed; top: 0px; bottom: 0; background-color: #212529; padding-top:50px">
			<nav class="navbar navbar-dark bg-dark">
	             <ul class="navbar-nav">
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Animales.html">
							<img src="./oveja.png" width="20" height="20" style="display: inline;">
							<img src="./cabra.png" width="20" height="20"style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Crias.html"> 
							<img src="./camion.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Leche.html"> 
							<img src="./leche.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./AlimentosSuministrados.html"> 
							<img src="./silo.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./PiensosMedicamentosos.html">
							<img src="./silo.png" width="25" height="25" style="display: inline;">
							<img src="./pildora.png" width="17" height="17" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Medicamentos.html">
							<img src="./medicamentos.png" width="25" height="25" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Enfermedades.html">
							<img src="./virus.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Pastos.html">
							<img src="./pastos.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<!-- 
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Inspecciones.html">
							<img src="./inspecciones.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					 -->
					<li class="nav-item">
						<a class="nav-link active" style="padding-left: 10px;" href="./Incidencias.html">
							<img src="./incidencias.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
					<li class="nav-item">
						 <a class="nav-link active" style="padding-left: 10px;" href="./Exportaciones.html"> 
							<img src="./exportaciones.png" width="30" height="30" style="display: inline;">
						</a>
					</li>
				</ul>
	        </nav>
        </div>
        
        <div>
		<nav class="navbar navbar-dark bg-dark justify-content-end">
			<div class="container-fluid" style="float:left;">
				<a class="navbar-brand" href="./Inicio.html" style="width:50%"><img src="./icono.png" width="40%" height="40%" style="display:inline; text-align:center;"></a>
			
				<div class="dropdown">
					<a class="nav-link dropdown-toggle" href="#"
						id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown"
						aria-expanded="false"> <b><script>document.write(sessionStorage.getItem("usuario_activo"));</script></b>
					</a>
					<ul class="dropdown-menu dropdown-menu-end"
						aria-labelledby="navbarDropdownMenuLink">
						<li><a class="dropdown-item" onclick="VerPerfil()">Ver
								Perfil</a></li>
						<li><a class="dropdown-item" onclick="CerrarSesion()">Cerrar
								Sesión</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</div>

		<div class="card" style="text-align:center;">
		  <div class="card-body" style="margin-left: 65px;position: absolute; text-align:left;">
		    <h3 class="card-title">¡BIENVENIDO <script>document.write(sessionStorage.getItem("usuario_activo"));</script>! </h3>
		    <img src="./facebook_cover_photo_1.png" width="90%" height="90%" style="display:inline; text-align:center;">
		    <p class="card-text"><em>En esta aplicación podrás realizar todas las gestiones para rellenar el libro de registro de tu explotación ganadera</em></p>
		    <p class="card-text"><em>A continuación se mostrarán las explotaciones dadas de alta para su usuario:</em></p>
		    <p class="card-text">
		    <div style="text-align:center;">
				<div id="listadoExplotacionesMovil"></div>
			</div>
			</p>
		  </div>
		</div>
	</div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->
  </body>
</html>

<script>
$(function() {

	var usuario = sessionStorage.getItem("usuario_activo");
	
	if(usuario == null){
		sessionStorage.clear();
		var url = "./IniciarSesion.html";
	    window.location.href = url;
	}else{
	
  		//Comprobar si es telefono u ordenador
	
	    try{ 
	        document.createEvent("TouchEvent"); 
	        document.getElementById('Movil').style.display='block';
	        sessionStorage.setItem('Movil', "true");
	        var parar;
	        parar = 1;
	        return true; 
	    }
	    catch(e){ 
	    	document.getElementById('NoMovil').style.display='block';
	    	sessionStorage.setItem('Movil', "false");
	        return false;
	    }
	}
  
});
</script>

<script>
$(function() {
  	var usuario = sessionStorage.getItem("usuario_activo");
	var movil = sessionStorage.getItem("Movil");
	if(sessionStorage.getItem("Movil") == "false"){
		var usuarioDatos= {
			'usuario' : usuario,
		};
	
		var usuarioLoginJSON = JSON.stringify(usuarioDatos);
	
		var url = './recogerExplotaciones';
	
		$.ajax({
			type : 'post',
			url : url,
			contentType : 'application/json',
			dataType : 'json',
			data : usuarioLoginJSON,
			success : function(data, textStatus, jqXHR) {
				var numExplotaciones = data.ListaExplotaciones;
				var size = Object.keys(numExplotaciones).length;
				
				txt = document.getElementById("listadoExplotaciones");
				var doc = "";
				
				doc = doc + "<table class='table' style='margin: 0 auto;'>";
					doc = doc + "<tr>";	
						doc = doc + "<th scope='col'>Número de explotación</th>";
						doc = doc + "<th scope='col'>Tipo de animal</th>";		
					doc = doc + "</tr>";
				for(var i=0; i<size; i++){
					doc = doc + "<tr>";	
						doc = doc + "<td class='table-primary'>" + data.ListaExplotaciones[i] + "</td>";
						doc = doc + "<td class='table-primary'>" + data.ListaTipoAnimal[i] + "</td>";		
					doc = doc + "</tr>";
				}
				doc = doc + "</table>";
				
				txt.innerHTML = doc;
			},
			error : function(jqXHR, exception) {
				// mostrarPantallaError(url, jqXHR);
			},
			statuscode : {
				404 : function() {
					//mostrarPantallaError(url);
				}
			}
		});
	}else{
		
		var usuarioDatos= {
			'usuario' : usuario,
		};
	
		var usuarioLoginJSON = JSON.stringify(usuarioDatos);
	
		var url = './recogerExplotaciones';
	
		$.ajax({
			type : 'post',
			url : url,
			contentType : 'application/json',
			dataType : 'json',
			data : usuarioLoginJSON,
			success : function(data, textStatus, jqXHR) {
				var numExplotaciones = data.ListaExplotaciones;
				var size = Object.keys(numExplotaciones).length;
				
				txt = document.getElementById("listadoExplotacionesMovil");
				var doc = "";
				
				doc = doc + "<table class='table' style='margin: 0 auto;'>";
					doc = doc + "<tr>";	
						doc = doc + "<th scope='col'>Número de explotación</th>";
						doc = doc + "<th scope='col'>Tipo de animal</th>";		
					doc = doc + "</tr>";
				for(var i=0; i<size; i++){
					doc = doc + "<tr>";	
						doc = doc + "<td class='table-primary'>" + data.ListaExplotaciones[i] + "</td>";
						doc = doc + "<td class='table-primary'>" + data.ListaTipoAnimal[i] + "</td>";		
					doc = doc + "</tr>";
				}
				doc = doc + "</table>";
				
				txt.innerHTML = doc;
			},
			error : function(jqXHR, exception) {
				// mostrarPantallaError(url, jqXHR);
			},
			statuscode : {
				404 : function() {
					//mostrarPantallaError(url);
				}
			}
		});
	}
	
	

});
</script>

<script>
function CerrarSesion(){
	sessionStorage.clear();
	var url = "./IniciarSesion.html";
    window.location.href = url;
}
</script>

<script>
/*function CargarOvejas(){

	//Primero hay que sacar los datos de base de datos de el usuario que se encuentra conectado
	var usuario = sessionStorage.getItem("usuario_activo");
	
	var usuarioDatos= {
		'usuario' : usuario,
	};

	var usuarioLoginJSON = JSON.stringify(usuarioDatos);

	var url = './cargarovejas';

	$.ajax({
		type : 'post',
		url : url,
		contentType : 'application/json',
		dataType : 'json',
		data : usuarioLoginJSON,
		success : function(data, textStatus, jqXHR) {
			sessionStorage.setItem('ListaOvejas', data.ListaOvejas);
			
			var url = "./Ovejas.html";
    		window.location.href = url;
		},
		error : function(jqXHR, exception) {
			// mostrarPantallaError(url, jqXHR);
		},
		statuscode : {
			404 : function() {
				//mostrarPantallaError(url);
			}
		}
	});
	
	
}*/
</script>

<script>
function VerPerfil(){
	//Primero hay que sacar los datos de base de datos de el usuario que se encuentra conectado
	var usuario = sessionStorage.getItem("usuario_activo");
	
	var usuarioDatos= {
		'usuario' : usuario,
	};

	var usuarioLoginJSON = JSON.stringify(usuarioDatos);

	var url = './sacardatos';

	$.ajax({
		type : 'post',
		url : url,
		contentType : 'application/json',
		dataType : 'json',
		data : usuarioLoginJSON,
		success : function(data, textStatus, jqXHR) {
			//Guardar las variables globales para mostrarlas en los input de Ver Perfil
			sessionStorage.setItem('Nombre', data.Nombre);
			sessionStorage.setItem('PApellido', data.PApellido);
			sessionStorage.setItem('SApellido', data.SApellido);
			sessionStorage.setItem('DNINIF', data.DNINIF);
			sessionStorage.setItem('CElectronico', data.CElectronico);
			sessionStorage.setItem('NumExplotacion', data.NumExplotacion);
			
			//Luego redirigir a la página
			var url = "./VerPerfil.html";
		    window.location.href = url;
		},
		error : function(jqXHR, exception) {
			// mostrarPantallaError(url, jqXHR);
		},
		statuscode : {
			404 : function() {
				//mostrarPantallaError(url);
			}
		}
	});
	
	
}
</script>